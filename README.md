# Timescale WebAPI

WebAPI приложение для работы с временными данными обработки. Позволяет загружать CSV-файлы с результатами, хранить их в базе данных PostgreSQL и выполнять аналитические запросы к результатам.

## Технологии

- .NET 9
- Entity Framework Core
- PostgreSQL
- Swagger (OpenAPI)

## Функционал

### 1. Загрузка CSV-файла

Метод принимает CSV-файл формата:
Date;ExecutionTime;Value
<Время начала ГГГГ-ММ-ДДTчч-мм-сс.ммммZ>;<Время выполнения в секундах>;<Показатель в виде числа с плавающей запятой>

(Формат можно поменять в appsettings.json)

**Валидация данных:**

- Дата не может быть позже текущей и раньше 01.01.2000
- Время выполнения не может быть меньше 0
- Значение показателя не может быть меньше 0
- Количество строк: от 1 до 10 000 (эти параметры меняются в appsettings.json)
- Все поля обязательны и должны соответствовать типам

Если файл невалидный, данные не сохраняются, а пользователю возвращается ошибка.

**Обработка данных:**

После загрузки CSV вычисляются интегральные результаты и сохраняются в таблицу `Results`:

- Дельта времени (`Date`) в секундах (максимум – минимум)
- Время запуска первой операции (минимальное `Date`)
- Среднее время выполнения (`ExecutionTime`)
- Среднее значение показателя (`Value`)
- Медиана по показателям (`Value`)
- Максимальное значение показателя (`Value`)
- Минимальное значение показателя (`Value`)

Если файл с таким именем уже существует, данные перезаписываются.

### 2. Получение списка результатов с фильтрацией

Метод возвращает записи из таблицы `Results` с возможностью фильтров:

- По имени файла
- По времени запуска первой операции (диапазон)
- По среднему показателю (`Value`) (диапазон)
- По среднему времени выполнения (`ExecutionTime`) (диапазон)

### 3. Получение последних 10 значений

Метод возвращает последние 10 записей из таблицы `Values`, отсортированных по времени начала `Date` для указанного файла.

## Запуск проекта

1. Настроить подключение к PostgreSQL в `appsettings.json`.
2. Выполнить миграции EF Core:

```bash
dotnet ef database update
```

3. Запуск
```bash
dotnet run
```

4. Тестирование
```bash
dotnet test
``` 